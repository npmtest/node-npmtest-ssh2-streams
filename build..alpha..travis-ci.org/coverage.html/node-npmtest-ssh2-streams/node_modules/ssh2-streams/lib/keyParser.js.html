<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-ssh2-streams/node_modules/ssh2-streams/lib/keyParser.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-ssh2-streams">npmtest-ssh2-streams (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-ssh2-streams/node_modules/ssh2-streams/lib/keyParser.js</span></h1>
    <h2>
        
        Statements: <span class="metric">9.02% <small>(12 / 133)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 77)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 1)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">9.02% <small>(12 / 133)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-ssh2-streams/node_modules/ssh2-streams/lib/</a> &#187; keyParser.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// TODO:
//    * handle multi-line header values (OpenSSH)?
//    * more thorough validation?
&nbsp;
var utils;
var Ber = require('asn1').Ber;
var semver = require('semver');
&nbsp;
var RE_PPK = /^PuTTY-User-Key-File-2: ssh-(rsa|dss)\r?\nEncryption: (aes256-cbc|none)\r?\nComment: ([^\r\n]*)\r?\nPublic-Lines: \d+\r?\n([\s\S]+?)\r?\nPrivate-Lines: \d+\r?\n([\s\S]+?)\r?\nPrivate-MAC: ([^\r\n]+)/;
var RE_HEADER_OPENSSH_PRIV = /^-----BEGIN (RSA|DSA|EC) PRIVATE KEY-----$/i;
var RE_FOOTER_OPENSSH_PRIV = /^-----END (?:RSA|DSA|EC) PRIVATE KEY-----$/i;
var RE_HEADER_OPENSSH_PUB = /^((?:(?:ssh-(rsa|dss))|ecdsa-sha2-nistp(256|384|521))(?:-cert-v0[01]@openssh.com)?) ([A-Z0-9a-z\/+=]+)(?:$|\s+([\S].*)?)$/i;
var RE_HEADER_RFC4716_PUB = /^---- BEGIN SSH2 PUBLIC KEY ----$/i;
var RE_FOOTER_RFC4716_PUB = /^---- END SSH2 PUBLIC KEY ----$/i;
var RE_HEADER_OPENSSH = /^([^:]+):\s*([\S].*)?$/i;
var RE_HEADER_RFC4716 = /^([^:]+): (.*)?$/i;
&nbsp;
module.exports = <span class="fstat-no" title="function not covered" >function(data) {</span>
<span class="cstat-no" title="statement not covered" >  if (Buffer.isBuffer(data))</span>
<span class="cstat-no" title="statement not covered" >    data = data.toString('utf8');</span>
  else <span class="cstat-no" title="statement not covered" >if (typeof data !== 'string')</span>
<span class="cstat-no" title="statement not covered" >    return new Error('Key data must be a Buffer or string');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var ret = {</span>
    fulltype: undefined,
    type: undefined,
    curve: undefined,
    extra: undefined,
    comment: undefined,
    encryption: undefined,
    private: undefined,
    privateOrig: undefined,
    public: undefined,
    publicOrig: undefined
  };
<span class="cstat-no" title="statement not covered" >  var m;</span>
<span class="cstat-no" title="statement not covered" >  var i;</span>
<span class="cstat-no" title="statement not covered" >  var len;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  data = data.trim().split(/\r\n|\n/);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  while (!data[0].length)</span>
<span class="cstat-no" title="statement not covered" >    data.shift();</span>
<span class="cstat-no" title="statement not covered" >  while (!data.slice(-1)[0].length)</span>
<span class="cstat-no" title="statement not covered" >    data.pop();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var orig = data.join('\n');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if ((m = RE_HEADER_OPENSSH_PRIV.exec(data[0]))</span>
      &amp;&amp; RE_FOOTER_OPENSSH_PRIV.test(data.slice(-1))) {
    // OpenSSH private key
<span class="cstat-no" title="statement not covered" >    var keyType = m[1].toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >    if (keyType === 'dsa')</span>
<span class="cstat-no" title="statement not covered" >      keyType = 'dss';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (keyType === 'ec' &amp;&amp; semver.lt(process.version, '5.2.0')) {</span>
<span class="cstat-no" title="statement not covered" >      return new Error(</span>
        'EC private keys are not supported in this version of node'
      );
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!RE_HEADER_OPENSSH.test(data[1])) {</span>
      // unencrypted, no headers
<span class="cstat-no" title="statement not covered" >      var privData = new Buffer(data.slice(1, -1).join(''), 'base64');</span>
<span class="cstat-no" title="statement not covered" >      if (keyType !== 'ec') {</span>
<span class="cstat-no" title="statement not covered" >        ret.fulltype = 'ssh-' + keyType;</span>
      } else {
        // ECDSA
<span class="cstat-no" title="statement not covered" >        var asnReader = new Ber.Reader(privData);</span>
<span class="cstat-no" title="statement not covered" >        asnReader.readSequence();</span>
<span class="cstat-no" title="statement not covered" >        asnReader.readInt();</span>
<span class="cstat-no" title="statement not covered" >        asnReader.readString(Ber.OctetString, true);</span>
<span class="cstat-no" title="statement not covered" >        asnReader.readByte(); </span>// Skip "complex" context type byte
<span class="cstat-no" title="statement not covered" >        var offset = asnReader.readLength(); </span>// Skip context length
<span class="cstat-no" title="statement not covered" >        if (offset !== null) {</span>
<span class="cstat-no" title="statement not covered" >          asnReader._offset = offset;</span>
<span class="cstat-no" title="statement not covered" >          switch (asnReader.readOID()) {</span>
            case '1.2.840.10045.3.1.7':
              // prime256v1/secp256r1
<span class="cstat-no" title="statement not covered" >              ret.fulltype = 'ecdsa-sha2-nistp256';</span>
<span class="cstat-no" title="statement not covered" >              break;</span>
            case '1.3.132.0.34':
              // secp384r1
<span class="cstat-no" title="statement not covered" >              ret.fulltype = 'ecdsa-sha2-nistp384';</span>
<span class="cstat-no" title="statement not covered" >              break;</span>
            case '1.3.132.0.35':
              // secp521r1
<span class="cstat-no" title="statement not covered" >              ret.fulltype = 'ecdsa-sha2-nistp521';</span>
<span class="cstat-no" title="statement not covered" >              break;</span>
          }
        }
<span class="cstat-no" title="statement not covered" >        if (ret.fulltype === undefined)</span>
<span class="cstat-no" title="statement not covered" >          return new Error('Unsupported EC private key type');</span>
      }
<span class="cstat-no" title="statement not covered" >      ret.private = privData;</span>
    } else {
      // possibly encrypted, headers
<span class="cstat-no" title="statement not covered" >      for (i = 1, len = data.length; i &lt; len; ++i) {</span>
<span class="cstat-no" title="statement not covered" >        m = RE_HEADER_OPENSSH.exec(data[i]);</span>
<span class="cstat-no" title="statement not covered" >        if (m) {</span>
<span class="cstat-no" title="statement not covered" >          m[1] = m[1].toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >          if (m[1] === 'dek-info') {</span>
<span class="cstat-no" title="statement not covered" >            m[2] = m[2].split(',');</span>
<span class="cstat-no" title="statement not covered" >            ret.encryption = m[2][0].toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >            if (m[2].length &gt; 1)</span>
<span class="cstat-no" title="statement not covered" >              ret.extra = m[2].slice(1);</span>
          }
        } else <span class="cstat-no" title="statement not covered" >if (data[i].length)</span>
<span class="cstat-no" title="statement not covered" >          break;</span>
      }
<span class="cstat-no" title="statement not covered" >      ret.private = new Buffer(data.slice(i, -1).join(''), 'base64');</span>
    }
<span class="cstat-no" title="statement not covered" >    ret.type = keyType;</span>
<span class="cstat-no" title="statement not covered" >    ret.privateOrig = new Buffer(orig);</span>
  } else <span class="cstat-no" title="statement not covered" >if (m = RE_HEADER_OPENSSH_PUB.exec(data[0])) {</span>
    // OpenSSH public key
<span class="cstat-no" title="statement not covered" >    ret.fulltype = m[1];</span>
<span class="cstat-no" title="statement not covered" >    ret.type = (m[2] || 'ec').toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >    ret.public = new Buffer(m[4], 'base64');</span>
<span class="cstat-no" title="statement not covered" >    ret.publicOrig = new Buffer(orig);</span>
<span class="cstat-no" title="statement not covered" >    ret.comment = m[5];</span>
<span class="cstat-no" title="statement not covered" >    if (m[3]) // ECDSA only</span>
<span class="cstat-no" title="statement not covered" >      ret.curve = 'nistp' + m[3];</span>
  } else <span class="cstat-no" title="statement not covered" >if (RE_HEADER_RFC4716_PUB.test(data[0])</span>
             &amp;&amp; RE_FOOTER_RFC4716_PUB.test(data.slice(-1))) {
<span class="cstat-no" title="statement not covered" >    if (data[1].indexOf(': ') === -1) {</span>
      // no headers
<span class="cstat-no" title="statement not covered" >      ret.public = new Buffer(data.slice(1, -1).join(''), 'base64');</span>
    } else {
      // headers
<span class="cstat-no" title="statement not covered" >      for (i = 1, len = data.length; i &lt; len; ++i) {</span>
<span class="cstat-no" title="statement not covered" >        if (data[i].indexOf(': ') === -1) {</span>
<span class="cstat-no" title="statement not covered" >          if (data[i].length)</span>
<span class="cstat-no" title="statement not covered" >            break; </span>// start of key data
          else
<span class="cstat-no" title="statement not covered" >            continue; </span>// empty line
        }
<span class="cstat-no" title="statement not covered" >        while (data[i].substr(-1) === '\\') {</span>
<span class="cstat-no" title="statement not covered" >          if (i + 1 &lt; len) {</span>
<span class="cstat-no" title="statement not covered" >            data[i] = data[i].slice(0, -1) + data[i + 1];</span>
<span class="cstat-no" title="statement not covered" >            data.splice(i + 1, 1);</span>
<span class="cstat-no" title="statement not covered" >            --len;</span>
          } else
<span class="cstat-no" title="statement not covered" >            return new Error('RFC4716 public key missing header continuation line');</span>
        }
<span class="cstat-no" title="statement not covered" >        m = RE_HEADER_RFC4716.exec(data[i]);</span>
<span class="cstat-no" title="statement not covered" >        if (m) {</span>
<span class="cstat-no" title="statement not covered" >          m[1] = m[1].toLowerCase();</span>
<span class="cstat-no" title="statement not covered" >          if (m[1] === 'comment') {</span>
<span class="cstat-no" title="statement not covered" >            ret.comment = m[2] || '';</span>
<span class="cstat-no" title="statement not covered" >            if (ret.comment[0] === '"' &amp;&amp; ret.comment.substr(-1) === '"')</span>
<span class="cstat-no" title="statement not covered" >              ret.comment = ret.comment.slice(1, -1);</span>
          }
        } else
<span class="cstat-no" title="statement not covered" >          return new Error('RFC4716 public key invalid header line');</span>
      }
<span class="cstat-no" title="statement not covered" >      ret.public = new Buffer(data.slice(i, -1).join(''), 'base64');</span>
    }
<span class="cstat-no" title="statement not covered" >    len = ret.public.readUInt32BE(0, true);</span>
<span class="cstat-no" title="statement not covered" >    var fulltype = ret.public.toString('ascii', 4, 4 + len);</span>
<span class="cstat-no" title="statement not covered" >    ret.fulltype = fulltype;</span>
<span class="cstat-no" title="statement not covered" >    if (fulltype === 'ssh-dss')</span>
<span class="cstat-no" title="statement not covered" >      ret.type = 'dss';</span>
    else <span class="cstat-no" title="statement not covered" >if (fulltype === 'ssh-rsa')</span>
<span class="cstat-no" title="statement not covered" >      ret.type = 'rsa';</span>
    else
<span class="cstat-no" title="statement not covered" >      return new Error('Unsupported RFC4716 public key type: ' + fulltype);</span>
<span class="cstat-no" title="statement not covered" >    ret.public = ret.public.slice(11);</span>
<span class="cstat-no" title="statement not covered" >    ret.publicOrig = new Buffer(orig);</span>
  } else <span class="cstat-no" title="statement not covered" >if (m = RE_PPK.exec(orig)) {</span>
    // m[1] = short type
    // m[2] = encryption type
    // m[3] = comment
    // m[4] = base64-encoded public key data:
    //         for "ssh-rsa":
    //          string "ssh-rsa"
    //          mpint  e    (public exponent)
    //          mpint  n    (modulus)
    //         for "ssh-dss":
    //          string "ssh-dss"
    //          mpint p     (modulus)
    //          mpint q     (prime)
    //          mpint g     (base number)
    //          mpint y     (public key parameter: g^x mod p)
    // m[5] = base64-encoded private key data:
    //         for "ssh-rsa":
    //          mpint  d    (private exponent)
    //          mpint  p    (prime 1)
    //          mpint  q    (prime 2)
    //          mpint  iqmp ([inverse of q] mod p)
    //         for "ssh-dss":
    //          mpint x     (private key parameter)
    // m[6] = SHA1 HMAC over:
    //          string  name of algorithm ("ssh-dss", "ssh-rsa")
    //          string  encryption type
    //          string  comment
    //          string  public key data
    //          string  private-plaintext (including the final padding)
&nbsp;
    // avoid cyclic require by requiring on first use
<span class="cstat-no" title="statement not covered" >    if (!utils)</span>
<span class="cstat-no" title="statement not covered" >      utils = require('./utils');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    ret.ppk = true;</span>
<span class="cstat-no" title="statement not covered" >    ret.type = m[1];</span>
<span class="cstat-no" title="statement not covered" >    ret.fulltype = 'ssh-' + m[1];</span>
<span class="cstat-no" title="statement not covered" >    if (m[2] !== 'none')</span>
<span class="cstat-no" title="statement not covered" >      ret.encryption = m[2];</span>
<span class="cstat-no" title="statement not covered" >    ret.comment = m[3];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    ret.public = new Buffer(m[4].replace(/\r?\n/g, ''), 'base64');</span>
<span class="cstat-no" title="statement not covered" >    var privateKey = new Buffer(m[5].replace(/\r?\n/g, ''), 'base64');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    ret.privateMAC = m[6].replace(/\r?\n/g, '');</span>
&nbsp;
    // automatically verify private key MAC if we don't need to wait for
    // decryption
<span class="cstat-no" title="statement not covered" >    if (!ret.encryption) {</span>
<span class="cstat-no" title="statement not covered" >      var valid = utils.verifyPPKMAC(ret, undefined, privateKey);</span>
<span class="cstat-no" title="statement not covered" >      if (!valid)</span>
<span class="cstat-no" title="statement not covered" >        throw new Error('PPK MAC mismatch');</span>
    }
&nbsp;
    // generate a PEM encoded version of the public key
<span class="cstat-no" title="statement not covered" >    var pubkey = utils.genPublicKey(ret);</span>
<span class="cstat-no" title="statement not covered" >    ret.public = pubkey.public;</span>
<span class="cstat-no" title="statement not covered" >    ret.publicOrig = pubkey.publicOrig;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    ret.private = privateKey;</span>
&nbsp;
    // automatically convert private key data to OpenSSL format (including PEM)
    // if we don't need to wait for decryption
<span class="cstat-no" title="statement not covered" >    if (!ret.encryption)</span>
<span class="cstat-no" title="statement not covered" >      utils.convertPPKPrivate(ret);</span>
  } else
<span class="cstat-no" title="statement not covered" >    return new Error('Unsupported key format');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return ret;</span>
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Sat Apr 22 2017 01:19:48 GMT+0000 (UTC)</div>
</div>
</body>
</html>
